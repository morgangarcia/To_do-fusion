{"version":3,"file":"browser.es5.es.js","sources":["../src/plugin.js","../src/with-translations.js","../src/translate.js","../src/index.js"],"sourcesContent":["/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport * as React from 'react';\nimport PropTypes from 'prop-types';\n\nimport i18n from 'fusion-plugin-i18n';\nimport type {I18nServiceType} from 'fusion-plugin-i18n';\nimport {ProviderPlugin} from 'fusion-react';\n\ntype ExtractReturnType = <V>(() => V) => V;\nclass BundleSplitConsumer extends React.Component<*, *> {\n  i18n: $Call<ExtractReturnType, $PropertyType<I18nServiceType, 'from'>>;\n\n  constructor(props, context) {\n    super(props, context);\n    // splitComponentLoaders comes from fusion-react-async/prepare-provider\n    // ids comes from fusion-react-async/split\n    // props.provides comes from fusion-react/plugin and references i18n()\n    this.i18n = props.provides.from(props.ctx);\n    if (context.splitComponentLoaders) {\n      context.splitComponentLoaders.push(ids => this.i18n.load(ids));\n    }\n  }\n  getChildContext() {\n    return {i18n: this.i18n};\n  }\n  render() {\n    return React.Children.only(this.props.children);\n  }\n}\nBundleSplitConsumer.contextTypes = {\n  splitComponentLoaders: PropTypes.array,\n};\nBundleSplitConsumer.childContextTypes = {\n  i18n: PropTypes.object.isRequired,\n};\n\nexport default ProviderPlugin.create('i18n', i18n, BundleSplitConsumer);\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport React, {Component} from 'react';\nimport type {ComponentType} from 'react';\nimport PropTypes from 'prop-types';\n\n/*\nThe `withTranslations` HOC takes an array of translation keys as an argument,\nbut does not use it at runtime.\n\nHowever, these keys are captured by `babel-plugin-i18n` at compile-time by\nFusion's compiler and the compiler uses generate a map of all translations\nin the app.\n\nThe translation map is then exposed by `fusion-plugin-i18n/chunk-translation-map.js`\n*/\nexport const withTranslations = (/*translationKeys*/) => {\n  return (OriginalComponent: ComponentType<any>) => {\n    class WithTranslations extends Component<any> {\n      translateProp: any;\n\n      constructor(props: any, context: any) {\n        super(props, context);\n        const {i18n} = context;\n        this.translateProp = i18n\n          ? (key, data) => i18n.translate(key, data)\n          : key => key;\n      }\n      render() {\n        const finalProps = Object.assign(\n          {translate: this.translateProp},\n          this.props\n        );\n        return React.createElement(OriginalComponent, finalProps);\n      }\n    }\n    WithTranslations.contextTypes = OriginalComponent.contextTypes = {\n      i18n: PropTypes.object,\n    };\n    WithTranslations.displayName = `withTranslations(${OriginalComponent.displayName ||\n      OriginalComponent.name})`;\n    return WithTranslations;\n  };\n};\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\n\nimport i18n from 'fusion-plugin-i18n';\n\ntype TranslatePropsType = {\n  id: string,\n  data?: Object,\n};\n\ntype TranslateContextType = {\n  i18n?: typeof i18n.provides,\n};\n\nfunction Translate(props: TranslatePropsType, context: TranslateContextType) {\n  return (\n    <span>\n      {(context.i18n && context.i18n.translate(props.id, props.data)) ||\n        props.id}\n    </span>\n  );\n}\n\nTranslate.contextTypes = {\n  i18n: PropTypes.object,\n};\n\nexport {Translate};\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport * as React from 'react';\nimport {\n  I18nToken,\n  I18nLoaderToken,\n  HydrationStateToken,\n  createI18nLoader,\n} from 'fusion-plugin-i18n';\n\nimport I18n from './plugin';\nimport {withTranslations} from './with-translations';\n\nexport default I18n;\nexport {I18nToken, I18nLoaderToken, HydrationStateToken, createI18nLoader};\nexport {Translate} from './translate';\n\ntype TranslatePropType = {\n  translate: (key: string, interpolations: Object) => string,\n};\ntype WithTranslationsType<TProps> = (\n  translationKeys: Array<string>\n) => (\n  React.ComponentType<TProps>\n) => React.ComponentType<TProps | TranslatePropType>;\n\nconst withTranslationsTyped: WithTranslationsType<*> = withTranslations;\nexport {withTranslationsTyped as withTranslations};\n"],"names":["BundleSplitConsumer","props","context","i18n","provides","from","ctx","splitComponentLoaders","push","load","ids","getChildContext","render","React","only","children","contextTypes","PropTypes","array","childContextTypes","object","isRequired","ProviderPlugin","create","withTranslations","OriginalComponent","WithTranslations","translateProp","key","data","translate","finalProps","Object","assign","createElement","Component","displayName","name","Translate","id","withTranslationsTyped"],"mappings":";;;;;;;;;;;;;;;AAQA,IAQMA;;;;;+BAGQC,KAAZ,EAAmBC,OAAnB,EAA4B;;;wCACpBD,KAAN,EAAaC,OAAb,UAD0B;;;;UAKrBC,IAAL,GAAYF,MAAMG,QAAN,CAAeC,IAAf,CAAoBJ,MAAMK,GAA1B,CAAZ;;QACIJ,QAAQK,qBAAZ,EAAmC;cACzBA,qBAAR,CAA8BC,IAA9B,CAAmC;eAAO,MAAKL,IAAL,CAAUM,IAAV,CAAeC,GAAf,CAAP;OAAnC;;;;;;;;SAGJC,6CAAkB;WACT;YAAO,KAAKR;KAAnB;;;SAEFS,2BAAS;WACAC,QAAA,CAAeC,IAAf,CAAoB,KAAKb,KAAL,CAAWc,QAA/B,CAAP;;;;EAjB8BF;;AAoBlCb,oBAAoBgB,YAApB,GAAmC;yBACVC,UAAUC;CADnC;AAGAlB,oBAAoBmB,iBAApB,GAAwC;QAChCF,UAAUG,MAAV,CAAiBC;CADzB;AAIA,WAAeC,eAAeC,MAAf,CAAsB,MAAtB,EAA8BpB,IAA9B,EAAoCH,mBAApC,CAAf;;;;;;;;;;;ACnCA,AAIA;;;;;;;;;;;AAUA,AAAO,IAAMwB,mBAAmB,SAAnBA,gBAAmB;;AAAyB;SAChD,UAACC,iBAAD,EAA2C;QAC1CC,gBAD0C;;;;;gCAIlCzB,KAAZ,EAAwBC,OAAxB,EAAsC;;;sCAC9BD,KAAN,EAAaC,OAAb;YACOC,OAF6B,GAErBD,OAFqB,CAE7BC,IAF6B;cAG/BwB,aAAL,GAAqBxB,UACjB,UAACyB,GAAD,EAAMC,IAAN;iBAAe1B,QAAK2B,SAAL,CAAeF,GAAf,EAAoBC,IAApB,CAAf;SADiB,GAEjB;iBAAOD,GAAP;SAFJ;;;;;;aAIFhB,MAX8C,qBAWrC;YACDmB,aAAaC,OAAOC,MAAP,CACjB;qBAAY,KAAKN;SADA,EAEjB,KAAK1B,KAFY,CAAnB;eAIOY,eAAMqB,aAAN,CAAoBT,iBAApB,EAAuCM,UAAvC,CAAP;OAhB4C;;;MACjBI,SADiB;;qBAmB/BnB,YAAjB,GAAgCS,kBAAkBT,YAAlB,GAAiC;YACzDC,UAAUG;KADlB;qBAGiBgB,WAAjB,0BAAmDX,kBAAkBW,WAAlB,IACjDX,kBAAkBY,IADpB;WAEOX,gBAAP;GAxBF;CADK;;ACtBP;;;;;;;AAQA,AAcA,SAASY,SAAT,CAAmBrC,KAAnB,EAA8CC,OAA9C,EAA6E;SAEzEW,2CACIX,QAAQC,IAAR,IAAgBD,QAAQC,IAAR,CAAa2B,SAAb,CAAuB7B,MAAMsC,EAA7B,EAAiCtC,MAAM4B,IAAvC,CAAjB,IACC5B,MAAMsC,EAFV,CADF;;;AAQFD,UAAUtB,YAAV,GAAyB;QACjBC,UAAUG;CADlB;;AC/BA;;;;;;;AAQA,AAwBA,IAAMoB,wBAAiDhB,gBAAvD;;;;;"}