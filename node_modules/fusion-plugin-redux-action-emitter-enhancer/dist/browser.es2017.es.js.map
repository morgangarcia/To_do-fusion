{"version":3,"file":"browser.es2017.es.js","sources":["../src/index.js"],"sourcesContent":["/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n/* eslint-env browser,node */\n\nimport type {StoreEnhancer, StoreCreator, Store} from 'redux';\n\nimport {createPlugin} from 'fusion-core';\nimport {UniversalEventsToken} from 'fusion-plugin-universal-events';\n\ntype ExtractReturnType = <V>(() => V) => V;\ntype IEmitter = $Call<typeof UniversalEventsToken, ExtractReturnType>;\n\nconst plugin = createPlugin({\n  deps: {\n    emitter: UniversalEventsToken,\n  },\n  provides({emitter}: {emitter: IEmitter}) {\n    if (__DEV__ && !emitter) {\n      throw new Error(`emitter is required, but was: ${emitter}`);\n    }\n\n    const service: StoreEnhancer<*, *, *> = (\n      createStore: StoreCreator<*, *, *>\n    ) => (...args: *) => {\n      const store: Store<*, *, *> = createStore(...args);\n      return {\n        ...store,\n        dispatch: action => {\n          // $FlowFixMe\n          emitter.from(store.ctx).emit('redux-action-emitter:action', action);\n          return store.dispatch(action);\n        },\n      };\n    };\n    return service;\n  },\n});\n\nexport default plugin;\n"],"names":["plugin","createPlugin","UniversalEventsToken","emitter","Error","service","createStore","args","store","action","from","ctx","emit","dispatch"],"mappings":";;;;;;;;;;;;;;;;AAYA,AAMA,MAAMA,SAASC,aAAa;QACpB;aACKC;GAFe;;WAIjB;;GAAT,EAAyC;QACnC,yCAAW,CAACC,OAAhB,EAAyB;YACjB,IAAIC,KAAJ,CAAW,iCAAgCD,OAAQ,EAAnD,CAAN;;;UAGIE,UACJC,WADsC,IAEnC,CAAC,GAAGC,IAAJ,KAAgB;YACbC,QAAwBF,YAAY,GAAGC,IAAf,CAA9B;+BAEKC,KADL;kBAEYC,UAAU;;kBAEVC,IAAR,CAAaF,MAAMG,GAAnB,EAAwBC,IAAxB,CAA6B,6BAA7B,EAA4DH,MAA5D;iBACOD,MAAMK,QAAN,CAAeJ,MAAf,CAAP;;;KATN;;WAaOJ,OAAP;;;CAtBW,CAAf;;;;"}